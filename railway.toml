# Backend Service Configuration
[build]
builder = "nixpacks"
buildCommand = "npm ci && npm run build"
workingDirectory = "backend"

[deploy]
startCommand = "npm run start:prod"
workingDirectory = "backend"
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10

[environments.production]
variables = { 
  NODE_ENV = "production",
  DATABASE_URL = "postgresql://postgres:PKzoOzvUtjJgxIzKpOoXALIIAfLuHWls@centerbeam.proxy.rlwy.net:13082/railway"
}

# Frontend Service Configuration (for separate deployment)
[frontend.build]
builder = "nixpacks"
buildCommand = "npm ci && npm run build"
workingDirectory = "frontend"

[frontend.deploy]
startCommand = "npm run start"
workingDirectory = "frontend"
healthcheckPath = "/"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10

[frontend.environments.production]
variables = { 
  NODE_ENV = "production",
  NEXT_PUBLIC_API_URL = "https://your-backend-service.railway.app/api"
}